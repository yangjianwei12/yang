<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Trap API: CHARGERCOMMS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Trap API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__trapset__chargercomms.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">CHARGERCOMMS<div class="ingroups"><a class="el" href="group__api.html">Customer Trap API</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga3c8c553e275f85fbf22537dbab7fe580"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__chargercomms.html#ga3c8c553e275f85fbf22537dbab7fe580">ChargerCommsTransmit</a> (uint16 length, uint8 *data)</td></tr>
<tr class="memdesc:ga3c8c553e275f85fbf22537dbab7fe580"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transmit a message to a charger using 2-wire Charger Comms. Every message must contain a one octet header, followed by up to 14 octets extra payload. The header is primarily populated by the system, the structure is as follows:  <a href="#ga3c8c553e275f85fbf22537dbab7fe580">More...</a><br/></td></tr>
<tr class="separator:ga3c8c553e275f85fbf22537dbab7fe580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga065f9ee93bafefc6c031fabd169d09e2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__chargercomms.html#ga065f9ee93bafefc6c031fabd169d09e2">ChargerCommsUartConfigure</a> (charger_comms_uart_config_key_t config_key, uint32 value)</td></tr>
<tr class="memdesc:ga065f9ee93bafefc6c031fabd169d09e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure ChargerComms UART interface. Note: ChargerCommsUartConfigure doesn't support Case device_id at the moment.  <a href="#ga065f9ee93bafefc6c031fabd169d09e2">More...</a><br/></td></tr>
<tr class="separator:ga065f9ee93bafefc6c031fabd169d09e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga90a53cba686b9e5680d60d3c73f2b490"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__chargercomms.html#ga90a53cba686b9e5680d60d3c73f2b490">ChargerCommsUartDiagnostics</a> (charger_comms_diagnostics *diagnostics)</td></tr>
<tr class="memdesc:ga90a53cba686b9e5680d60d3c73f2b490"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return diagnostic information from ChargerCommsUart Diagnostic information can be requested at any point while the ChargerCommsUart stream is active. This includes:  <a href="#ga90a53cba686b9e5680d60d3c73f2b490">More...</a><br/></td></tr>
<tr class="separator:ga90a53cba686b9e5680d60d3c73f2b490"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadefff14466fd206032252cc73f07dcde"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__chargercomms.html#gadefff14466fd206032252cc73f07dcde">ChargerCommsUartPriorityTransmit</a> (const uint8 *data, uint16 length, charger_comms_uart_address reset_seqnum)</td></tr>
<tr class="memdesc:gadefff14466fd206032252cc73f07dcde"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request to send a broadcast message at the next available opportunity. Earbud can use this API to reset the sequence numbers on both sides. In order to do it, the parameter reset_seqnum must be set to the device address which the broadcast message is sent to.  <a href="#gadefff14466fd206032252cc73f07dcde">More...</a><br/></td></tr>
<tr class="separator:gadefff14466fd206032252cc73f07dcde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabaf838558a723128d500e4909d76680b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__chargercomms.html#gabaf838558a723128d500e4909d76680b">ChargerCommsUartResetSeqNum</a> (charger_comms_uart_address address)</td></tr>
<tr class="memdesc:gabaf838558a723128d500e4909d76680b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the sequence numbers associated with a particular charger comms device.  <a href="#gabaf838558a723128d500e4909d76680b">More...</a><br/></td></tr>
<tr class="separator:gabaf838558a723128d500e4909d76680b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa7ec5cf201f8758a900805b25181c56f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="message___8h.html#a51d7b6544fb734b892b35ce3f56a579a">Task</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__chargercomms.html#gaa7ec5cf201f8758a900805b25181c56f">MessageChargerCommsTask</a> (<a class="el" href="message___8h.html#a51d7b6544fb734b892b35ce3f56a579a">Task</a> task)</td></tr>
<tr class="memdesc:gaa7ec5cf201f8758a900805b25181c56f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register a task to handle charger comm messages.  <a href="#gaa7ec5cf201f8758a900805b25181c56f">More...</a><br/></td></tr>
<tr class="separator:gaa7ec5cf201f8758a900805b25181c56f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga690edc32d26829dbd9f71b6a34ec0547"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sink___8h.html#a250a23fcb6a29255bb2526a002d691b2">Sink</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__chargercomms.html#ga690edc32d26829dbd9f71b6a34ec0547">StreamChargerCommsUartSink</a> (void)</td></tr>
<tr class="memdesc:ga690edc32d26829dbd9f71b6a34ec0547"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the Sink associated with the ChargerCommsUart. Before StreamChargerCommsUartSink is called, PioSetMapPins32Bank and PioSetFunction should be called to assign the pios to UART signals and ChargerCommsUartConfigure is called to configure the UART. To transmit a ChargerComms message, SinkFlushHeader should be called with the message header defined by charger_comms_uart_tx_msg_header_t. The received ChargerComms message in source buffer has a message header is defined by charger_comms_uart_rx_msg_header_t which includes the device ID which the message is sent by. Returns zero if it is unavailable. For example there is not enough buffer.  <a href="#ga690edc32d26829dbd9f71b6a34ec0547">More...</a><br/></td></tr>
<tr class="separator:ga690edc32d26829dbd9f71b6a34ec0547"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga3c8c553e275f85fbf22537dbab7fe580"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChargerCommsTransmit </td>
          <td>(</td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8 *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Transmit a message to a charger using 2-wire Charger Comms. Every message must contain a one octet header, followed by up to 14 octets extra payload. The header is primarily populated by the system, the structure is as follows: </p>
<pre class="fragment">*         0: Reserved (set to 0)
*         D: Destination (2 bits)
*            msb    lsb
*             |      |
*             00DD0000
*               ^
*               |
*               |
*               |
*             destination
*        Destinations:
*             0: Case
*             1: Right Device
*             2: Left Device
*             3: Reserved
* </pre><p> Every transmit request will be followed with a MESSAGE_CHARGERCOMMS_STATUS containing transmission status.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">length</td><td>The total length of the packet (including the header) to be transmitted in octets. The minimum length is therefore 1, to hold the header and the maximum is 15 octets (1 octet header, 14 octet payload).</td></tr>
    <tr><td class="paramname">data</td><td>The data to be transmitted, including the header.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Boolean to indicate whether the request was accepted. If True a MESSAGE_CHARGERCOMMS_STATUS will follow containing the status of the transmission. </dd></dl>

</div>
</div>
<a class="anchor" id="ga065f9ee93bafefc6c031fabd169d09e2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChargerCommsUartConfigure </td>
          <td>(</td>
          <td class="paramtype">charger_comms_uart_config_key_t&#160;</td>
          <td class="paramname"><em>config_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure ChargerComms UART interface. Note: ChargerCommsUartConfigure doesn't support Case device_id at the moment. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">config_key</td><td>Configuration key. </td></tr>
    <tr><td class="paramname">value</td><td>The value of the configuration key. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga90a53cba686b9e5680d60d3c73f2b490"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChargerCommsUartDiagnostics </td>
          <td>(</td>
          <td class="paramtype">charger_comms_diagnostics *&#160;</td>
          <td class="paramname"><em>diagnostics</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return diagnostic information from ChargerCommsUart Diagnostic information can be requested at any point while the ChargerCommsUart stream is active. This includes: </p>
<pre class="fragment">       - A history buffer of the last \a
</pre><p> CHARGER_COMMS_DIAGNOSTICS_HISTORY_SIZE messages received/sent.</p>
<ul>
<li>Each message recorded in the buffer contains: &ndash; A timestamp of when it was received/transmitted. &ndash; The status of the packet - was it valid, if not, why it was invalid. &ndash; The charger comms header, and case comms header if applicable.</li>
<li>The last Case Comms message recieved.</li>
<li>A history buffer of the last <em>CHARGER_COMMS_DIAGNOSTICS_HISTORY_SIZE</em> charger attached state changes.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">diagnostics</td><td>The diagnostics structure to populate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return true if the request is accepted, false otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="gadefff14466fd206032252cc73f07dcde"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChargerCommsUartPriorityTransmit </td>
          <td>(</td>
          <td class="paramtype">const uint8 *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">charger_comms_uart_address&#160;</td>
          <td class="paramname"><em>reset_seqnum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request to send a broadcast message at the next available opportunity. Earbud can use this API to reset the sequence numbers on both sides. In order to do it, the parameter reset_seqnum must be set to the device address which the broadcast message is sent to. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Pointer to the message to be sent.</td></tr>
    <tr><td class="paramname">length</td><td>Length of the message in octets. It only includes ChargerComms header plus optional CaseComms header and payload.</td></tr>
    <tr><td class="paramname">reset_seqnum</td><td>The device whose sequence numbers should be reset. A broadcast address will result in both the left and right earbuds sequence numbers being reset.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Boolean to indicate whether the request is accepted. Return true if the request is accepted, false otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="gabaf838558a723128d500e4909d76680b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ChargerCommsUartResetSeqNum </td>
          <td>(</td>
          <td class="paramtype">charger_comms_uart_address&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the sequence numbers associated with a particular charger comms device. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>Which device to reset the sequence numbers of. A broadcast address will result in both the left and right earbuds sequence numbers being reset.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Boolean to indicate whether the request was accepted. Return true if the sequence numbers were reset, false otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="gaa7ec5cf201f8758a900805b25181c56f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="message___8h.html#a51d7b6544fb734b892b35ce3f56a579a">Task</a> MessageChargerCommsTask </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message___8h.html#a51d7b6544fb734b892b35ce3f56a579a">Task</a>&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register a task to handle charger comm messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">task</td><td>The task which will receive the messages. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The old task (or zero). </dd></dl>

</div>
</div>
<a class="anchor" id="ga690edc32d26829dbd9f71b6a34ec0547"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sink___8h.html#a250a23fcb6a29255bb2526a002d691b2">Sink</a> StreamChargerCommsUartSink </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find the Sink associated with the ChargerCommsUart. Before StreamChargerCommsUartSink is called, PioSetMapPins32Bank and PioSetFunction should be called to assign the pios to UART signals and ChargerCommsUartConfigure is called to configure the UART. To transmit a ChargerComms message, SinkFlushHeader should be called with the message header defined by charger_comms_uart_tx_msg_header_t. The received ChargerComms message in source buffer has a message header is defined by charger_comms_uart_rx_msg_header_t which includes the device ID which the message is sent by. Returns zero if it is unavailable. For example there is not enough buffer. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
