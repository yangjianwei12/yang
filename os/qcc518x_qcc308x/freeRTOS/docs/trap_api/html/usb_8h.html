<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Trap API: usb.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Trap API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('usb_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">usb.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga92bfe6572517af08341e7c2b72c236a4"><td class="memItemLeft" align="right" valign="top">UsbAltInterface&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#ga92bfe6572517af08341e7c2b72c236a4">UsbAddAltInterface</a> (UsbInterface interface, const uint8 *if_descriptor, uint16 descriptor_length)</td></tr>
<tr class="memdesc:ga92bfe6572517af08341e7c2b72c236a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds additional alternate USB interface. See the USB2.0 spec section 9.6.5 After adding interface with UsbAddInterface, this trap can be used to add additional alternate interfaces. The original UsbAddInterface call creates bAlternateSetting=0 without endpoints. If any isochronous endpoints have been then added with <a class="el" href="group__trapset__usb.html#gad37ce89088882266d0143e82a64b2aec" title="Adds USB endpoints to the interface passed. See the USB2.0 spec section 9.6.6. ">UsbAddEndPoints()</a> this creates another alternate interface bAlternateSetting=1 which contains all the endpoints and class interface descriptors. Any additional alternate interfaces can be added with UsbAddAltInterface and get consecutive bAlternateSetting indices. UsbAddEndPoints and UsbAddDescriptor can be then used to fill it with endpoints and class endpoint descriptors. Endpoints and endpoint class descriptors are always associate with the last alternate interface, therefore alternate interfaces are configured one by one with UsbAddEndPoints and UsbAddDescriptor calls following corresponding UsbAddAltInterface calls. Additional alternate interfaces can have different class descriptors and endpoint parameters except the following limitation: all alternate interfaces with non-zero number of endpoints have the same number of endpoints and corresponding endpoints have the same bEndpointAddress and bmAttributes. This effectively forbids creating alternate interfaces with different sets of endpoints, while still allowing zero-bandwidth alternate interfaces without endpoints. GET_DESCRIPTOR request directed to USB interface to request class descriptor will be matched against all descriptors added with <a class="el" href="group__trapset__usb.html#ga2345617bcbc067bcea4e9c1af97e58d2" title="Adds a USB descriptor to an interface or endpoint. ">UsbAddDescriptor()</a> and also against the "type" specified in the <a class="el" href="group__trapset__usb.html#ga7584677a21af75117d4110f1fbf348e1" title="Adds a USB interface. See the USB2.0 spec section 9.6.5 This API is used to register both the USB int...">UsbAddInterface()</a> call. If the latter matches, then class descriptors of the currently active alternate interface will be returned.  <a href="group__trapset__usb.html#ga92bfe6572517af08341e7c2b72c236a4">More...</a><br/></td></tr>
<tr class="separator:ga92bfe6572517af08341e7c2b72c236a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3638736a761b4611d985645acd119cca"><td class="memItemLeft" align="right" valign="top">uint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#ga3638736a761b4611d985645acd119cca">UsbAddConfiguration</a> (const ConfigDescriptorInfo *desc_info)</td></tr>
<tr class="memdesc:ga3638736a761b4611d985645acd119cca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates an additional USB configuration. All devices initially have one configuration (with iConfiguration, bmAttributes and bMaxPower in the configuration descriptor being provided by pskeys), and for most devices one configuration is all you want. However, if desired, this function can be used to create additional configurations. It will add a new configuration each time it is called, it can be called repeatedly, but must be called before any interfaces have been added. The support for multiple configurations is limited in that the interfaces/endpoints have to be the same for all configurations, the only values that can be different are the iConfiguration, bmAttributes and bMaxPower fields in the configuration descriptor. For the new configuration, these values are provided by the members of 'desc_info'. Each member of 'desc_info' can be set to the special value SAME_AS_FIRST_CONFIG in which case the corresponding entry in the configuration descriptor for the new configuration will just be copied over from the first configuration.  <a href="group__trapset__usb.html#ga3638736a761b4611d985645acd119cca">More...</a><br/></td></tr>
<tr class="separator:ga3638736a761b4611d985645acd119cca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2345617bcbc067bcea4e9c1af97e58d2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#ga2345617bcbc067bcea4e9c1af97e58d2">UsbAddDescriptor</a> (UsbInterface interface, uint16 type, const uint8 *descriptor, uint16 descriptor_length)</td></tr>
<tr class="memdesc:ga2345617bcbc067bcea4e9c1af97e58d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a USB descriptor to an interface or endpoint.  <a href="group__trapset__usb.html#ga2345617bcbc067bcea4e9c1af97e58d2">More...</a><br/></td></tr>
<tr class="separator:ga2345617bcbc067bcea4e9c1af97e58d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf27dec9d7043ae8af0967d69fbeff7e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#gaf27dec9d7043ae8af0967d69fbeff7e8">UsbAddDfuInterface</a> (void)</td></tr>
<tr class="memdesc:gaf27dec9d7043ae8af0967d69fbeff7e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a DFU interface to the USB port.  <a href="group__trapset__usb.html#gaf27dec9d7043ae8af0967d69fbeff7e8">More...</a><br/></td></tr>
<tr class="separator:gaf27dec9d7043ae8af0967d69fbeff7e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad37ce89088882266d0143e82a64b2aec"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#gad37ce89088882266d0143e82a64b2aec">UsbAddEndPoints</a> (UsbInterface interface, uint16 num_end_points, const EndPointInfo *end_point_info)</td></tr>
<tr class="memdesc:gad37ce89088882266d0143e82a64b2aec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds USB endpoints to the interface passed. See the USB2.0 spec section 9.6.6.  <a href="group__trapset__usb.html#gad37ce89088882266d0143e82a64b2aec">More...</a><br/></td></tr>
<tr class="separator:gad37ce89088882266d0143e82a64b2aec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7584677a21af75117d4110f1fbf348e1"><td class="memItemLeft" align="right" valign="top">UsbInterface&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#ga7584677a21af75117d4110f1fbf348e1">UsbAddInterface</a> (const UsbCodes *codes, uint16 type, const uint8 *if_descriptor, uint16 descriptor_length)</td></tr>
<tr class="memdesc:ga7584677a21af75117d4110f1fbf348e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a USB interface. See the USB2.0 spec section 9.6.5 This API is used to register both the USB interface descriptor details and any class specific descriptors to be returned to the host.  <a href="group__trapset__usb.html#ga7584677a21af75117d4110f1fbf348e1">More...</a><br/></td></tr>
<tr class="separator:ga7584677a21af75117d4110f1fbf348e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4830212525db574ad5a789e4c72460b5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#ga4830212525db574ad5a789e4c72460b5">UsbAddInterfaceAssociationDescriptor</a> (uint16 if_num, const uint8 *ia_descriptor, uint16 descriptor_length)</td></tr>
<tr class="memdesc:ga4830212525db574ad5a789e4c72460b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an Interface Association Descriptor to a USB interface.  <a href="group__trapset__usb.html#ga4830212525db574ad5a789e4c72460b5">More...</a><br/></td></tr>
<tr class="separator:ga4830212525db574ad5a789e4c72460b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9209a0a8146c2354dcd71b66e65057f9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#ga9209a0a8146c2354dcd71b66e65057f9">UsbAddStringDescriptor</a> (uint8 string_index, const uint16 *string_descriptor)</td></tr>
<tr class="memdesc:ga9209a0a8146c2354dcd71b66e65057f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a USB String Descriptor. See the USB2.0 spec section 9.6.7 The string_descriptor passed is in UTF16 format and MUST be NUL terminated. The NUL terminator will not be passed to USB host as part of the string descriptor when a string descriptor request is received, it is simply to denote the end of the string. Example: In order to register string descriptor 11 as "Test". UsbAddStringDescriptor(11, myStringDescriptor);.  <a href="group__trapset__usb.html#ga9209a0a8146c2354dcd71b66e65057f9">More...</a><br/></td></tr>
<tr class="separator:ga9209a0a8146c2354dcd71b66e65057f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafac39dbcb0154b54652135a787ce8f41"><td class="memItemLeft" align="right" valign="top">usb_attached_status&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#gafac39dbcb0154b54652135a787ce8f41">UsbAttachedStatus</a> (void)</td></tr>
<tr class="memdesc:gafac39dbcb0154b54652135a787ce8f41"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control of USB EndPoints, and other USB related traps.  <a href="group__trapset__usb.html#gafac39dbcb0154b54652135a787ce8f41">More...</a><br/></td></tr>
<tr class="separator:gafac39dbcb0154b54652135a787ce8f41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2e9c50236d60b166099de2033edb2657"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#ga2e9c50236d60b166099de2033edb2657">UsbConnect</a> (bool connect)</td></tr>
<tr class="memdesc:ga2e9c50236d60b166099de2033edb2657"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manually connect or disconnect device to USB host If USB VBUS is not connected to VCHG, application is responsible for monitoring its state by reading a PIO input. When VBUS goes high, application uses this trap to connect device to the host (by attaching USB DP pullup) and start enumeration. When VBUS goes low, application shall disconnect device from the host (detach USB DP pullup). The System Manager MIBKEY ChargerIsUsb must be set to "False".  <a href="group__trapset__usb.html#ga2e9c50236d60b166099de2033edb2657">More...</a><br/></td></tr>
<tr class="separator:ga2e9c50236d60b166099de2033edb2657"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa166a47be621b208d806252f69f10066"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#gaa166a47be621b208d806252f69f10066">UsbDebugAllow</a> (bool flag)</td></tr>
<tr class="memdesc:gaa166a47be621b208d806252f69f10066"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allow or Disallow USB debugging This trap can be used to allow or disallow USB debug (still needing challenge-response), but only under the following conditions:  <a href="group__trapset__usb.html#gaa166a47be621b208d806252f69f10066">More...</a><br/></td></tr>
<tr class="separator:gaa166a47be621b208d806252f69f10066"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga500c690a5499e923231da211e9401aee"><td class="memItemLeft" align="right" valign="top">uint32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#ga500c690a5499e923231da211e9401aee">UsbDescriptorsHash</a> (uint32 descriptors_bitmask)</td></tr>
<tr class="memdesc:ga500c690a5499e923231da211e9401aee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return hash of selected USB descriptors Calculate hash of selected USB descriptors. Application can then use the hash to identify particular configuration, for example by returning it in the USB serial number string. The recommended way to run the trap is to pass "0" as a parameter: uint32 hash = UsbDescriptorsHash(0); This hashes all descriptors that the current firmware is able to hash, specifically these: USB_DT_DEVICE, USB_DT_CONFIG, USB_DT_STRING and USB_DT_REPORT. Alternatively bitmask can be supplied to select which descriptors to include in the hash: uint32 hash = UsbDescriptorsHash((1 &lt;&lt; USB_DT_DEVICE) | (1 &lt;&lt; USB_DT_CONFIG)); However this can not dump descriptors beyond descriptor type 31 due to limited size of the parameter type. If some of the requested descriptor are not found/supported, this is ignored. The trap can return "0" if none of them are supported. Descriptors need to be already configured to be included in the hash. The best place for the trap is before <a class="el" href="group__trapset__usb__hub.html#ga1a96f2f0b88006874449e7cc94036bc0" title="Control of internal USB hub. ">UsbHubAttach()</a>. The trap can't be called while device is attached to the hub and returns "0" in this case. USB_DT_STRING: all of the following descriptors are included in the hash, if present:  <a href="group__trapset__usb.html#ga500c690a5499e923231da211e9401aee">More...</a><br/></td></tr>
<tr class="separator:ga500c690a5499e923231da211e9401aee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0e8544c1cf28ee309fd220980f483a75"><td class="memItemLeft" align="right" valign="top">usb_device_state&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__trapset__usb.html#ga0e8544c1cf28ee309fd220980f483a75">UsbDeviceState</a> (void)</td></tr>
<tr class="memdesc:ga0e8544c1cf28ee309fd220980f483a75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return state of USB device Returns state of USB device implemented by the application or if no application devices attached with <a class="el" href="group__trapset__usb__hub.html#ga1a96f2f0b88006874449e7cc94036bc0" title="Control of internal USB hub. ">UsbHubAttach()</a>, status of internal USB hub connection to the host.  <a href="group__trapset__usb.html#ga0e8544c1cf28ee309fd220980f483a75">More...</a><br/></td></tr>
<tr class="separator:ga0e8544c1cf28ee309fd220980f483a75"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="usb_8h.html">usb.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
